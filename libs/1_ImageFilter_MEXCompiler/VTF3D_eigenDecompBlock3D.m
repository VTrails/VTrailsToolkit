function [Evl1,Evl2,Evl3,Evc1,Evc2,Evc3,idx2discard] = VTF3D_eigenDecompBlock3D(VG,idx,SortByMagnitude,AbsoluteFlag)%#codegen
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%  Stefano Moriconi, July-2017, vtrailstoolkit@gmail.com 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

VEval = complex(zeros([length(idx),3]));
VEvec1 = complex(zeros([length(idx),3]));
VEvec2 = complex(zeros([length(idx),3]));
VEvec3 = complex(zeros([length(idx),3]));

Ixx = complex( VG.Ixx(idx) );
Ixy = complex( VG.Ixy(idx) );
Ixz = complex( VG.Ixz(idx) );
Iyy = complex( VG.Iyy(idx) );
Iyz = complex( VG.Iyz(idx) );
Izz = complex( VG.Izz(idx) );

% Computing EigenValues
VEval(:,1) = complex( Ixx./3 + Iyy./3 + Izz./3 + ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3)./((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + (((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^2 - ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3).^3).^(1./2) + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^(1./3) + ((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + (((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^2 - ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3).^3).^(1./2) + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^(1./3) );
VEval(:,2) = complex( Ixx./3 + Iyy./3 + Izz./3 - ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3)./(2.*((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + (((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^2 - ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3).^3).^(1./2) + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^(1./3)) - (3.^(1./2).*(((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3)./((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + (((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^2 - ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3).^3).^(1./2) + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^(1./3) - ((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + (((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^2 - ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3).^3).^(1./2) + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^(1./3)).*1i)./2 - ((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + (((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^2 - ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3).^3).^(1./2) + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^(1./3)./2 );
VEval(:,3) = complex( Ixx./3 + Iyy./3 + Izz./3 - ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3)./(2.*((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + (((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^2 - ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3).^3).^(1./2) + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^(1./3)) + (3.^(1./2).*(((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3)./((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + (((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^2 - ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3).^3).^(1./2) + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^(1./3) - ((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + (((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^2 - ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3).^3).^(1./2) + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^(1./3)).*1i)./2 - ((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + (((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^2 - ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3).^3).^(1./2) + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^(1./3)./2 );

VEvalout = (abs(VEval) + 1e-6*abs(rand(size(VEval))) ) .* sign(real(VEval));

% Computing EigenVectors
% Eigenvector V of the first eigenvalue
VEvec1(:,1) = complex( (Ixz.^2.*Iyz - Ixy.*Izz.*Ixz + Iyz.^3 - Iyy.*Izz.*Iyz)./(Ixy.*Ixz.^2 - Ixy.*Iyz.^2 - Ixx.*Ixz.*Iyz + Ixz.*Iyy.*Iyz) - (Iyz.*(Ixx./3 + Iyy./3 + Izz./3 + ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3)./((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + (((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^2 - ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3).^3).^(1./2) + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^(1./3) + ((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + (((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^2 - ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3).^3).^(1./2) + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^(1./3)).^2)./(Ixy.*Ixz.^2 - Ixy.*Iyz.^2 - Ixx.*Ixz.*Iyz + Ixz.*Iyy.*Iyz) + ((Ixy.*Ixz + Iyy.*Iyz + Iyz.*Izz).*(Ixx./3 + Iyy./3 + Izz./3 + ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3)./((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + (((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^2 - ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3).^3).^(1./2) + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^(1./3) + ((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + (((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^2 - ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3).^3).^(1./2) + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^(1./3)))./(Ixy.*Ixz.^2 - Ixy.*Iyz.^2 - Ixx.*Ixz.*Iyz + Ixz.*Iyy.*Iyz) );
VEvec1(:,2) = complex( (Ixz.*(Ixx./3 + Iyy./3 + Izz./3 + ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3)./((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + (((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^2 - ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3).^3).^(1./2) + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^(1./3) + ((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + (((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^2 - ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3).^3).^(1./2) + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^(1./3)).^2)./(Ixy.*Ixz.^2 - Ixy.*Iyz.^2 - Ixx.*Ixz.*Iyz + Ixz.*Iyy.*Iyz) - (Ixz.^3 + Ixz.*Iyz.^2 - Ixx.*Izz.*Ixz - Ixy.*Izz.*Iyz)./(Ixy.*Ixz.^2 - Ixy.*Iyz.^2 - Ixx.*Ixz.*Iyz + Ixz.*Iyy.*Iyz) - ((Ixx.*Ixz + Ixy.*Iyz + Ixz.*Izz).*(Ixx./3 + Iyy./3 + Izz./3 + ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3)./((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + (((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^2 - ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3).^3).^(1./2) + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^(1./3) + ((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + (((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^2 - ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3).^3).^(1./2) + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^(1./3)))./(Ixy.*Ixz.^2 - Ixy.*Iyz.^2 - Ixx.*Ixz.*Iyz + Ixz.*Iyy.*Iyz) );
VEvec1(:,3) = complex( ones(size(Ixx)) );%!
% Regularization of Values
% Evec1(~isfinite(Evec1)) = 0; % all NaNs and Vnf must be equal to 0!
% Normalization of Evec1 to unit vector (divided by its norm) 
VEvec1norm = (sum((abs(VEvec1).^2),2)).^(1./2);
VEvec1N = VEvec1./repmat(VEvec1norm,[1 3]);
NaN1Check = ~isfinite(VEvec1N(:,1));
VEvec1Nout = abs(VEvec1N) .* sign(real(VEvec1N));

% Eigenvector V of the second eigenvalue
VEvec2(:,1) = complex( (Ixz.^2.*Iyz - Ixy.*Izz.*Ixz + Iyz.^3 - Iyy.*Izz.*Iyz)./(Ixy.*Ixz.^2 - Ixy.*Iyz.^2 - Ixx.*Ixz.*Iyz + Ixz.*Iyy.*Iyz) - (Iyz.*(Ixx./3 + Iyy./3 + Izz./3 - ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3)./(2.*((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + (((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^2 - ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3).^3).^(1./2) + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^(1./3)) - (3.^(1./2).*(((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3)./((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + (((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^2 - ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3).^3).^(1./2) + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^(1./3) - ((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + (((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^2 - ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3).^3).^(1./2) + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^(1./3)).*1i)./2 - ((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + (((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^2 - ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3).^3).^(1./2) + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^(1./3)./2).^2)./(Ixy.*Ixz.^2 - Ixy.*Iyz.^2 - Ixx.*Ixz.*Iyz + Ixz.*Iyy.*Iyz) + ((Ixy.*Ixz + Iyy.*Iyz + Iyz.*Izz).*(Ixx./3 + Iyy./3 + Izz./3 - ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3)./(2.*((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + (((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^2 - ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3).^3).^(1./2) + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^(1./3)) - (3.^(1./2).*(((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3)./((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + (((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^2 - ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3).^3).^(1./2) + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^(1./3) - ((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + (((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^2 - ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3).^3).^(1./2) + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^(1./3)).*1i)./2 - ((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + (((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^2 - ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3).^3).^(1./2) + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^(1./3)./2))./(Ixy.*Ixz.^2 - Ixy.*Iyz.^2 - Ixx.*Ixz.*Iyz + Ixz.*Iyy.*Iyz) );
VEvec2(:,2) = complex( (Ixz.*(Ixx./3 + Iyy./3 + Izz./3 - ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3)./(2.*((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + (((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^2 - ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3).^3).^(1./2) + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^(1./3)) - (3.^(1./2).*(((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3)./((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + (((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^2 - ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3).^3).^(1./2) + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^(1./3) - ((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + (((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^2 - ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3).^3).^(1./2) + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^(1./3)).*1i)./2 - ((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + (((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^2 - ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3).^3).^(1./2) + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^(1./3)./2).^2)./(Ixy.*Ixz.^2 - Ixy.*Iyz.^2 - Ixx.*Ixz.*Iyz + Ixz.*Iyy.*Iyz) - (Ixz.^3 + Ixz.*Iyz.^2 - Ixx.*Izz.*Ixz - Ixy.*Izz.*Iyz)./(Ixy.*Ixz.^2 - Ixy.*Iyz.^2 - Ixx.*Ixz.*Iyz + Ixz.*Iyy.*Iyz) - ((Ixx.*Ixz + Ixy.*Iyz + Ixz.*Izz).*(Ixx./3 + Iyy./3 + Izz./3 - ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3)./(2.*((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + (((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^2 - ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3).^3).^(1./2) + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^(1./3)) - (3.^(1./2).*(((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3)./((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + (((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^2 - ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3).^3).^(1./2) + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^(1./3) - ((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + (((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^2 - ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3).^3).^(1./2) + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^(1./3)).*1i)./2 - ((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + (((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^2 - ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3).^3).^(1./2) + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^(1./3)./2))./(Ixy.*Ixz.^2 - Ixy.*Iyz.^2 - Ixx.*Ixz.*Iyz + Ixz.*Iyy.*Iyz) );
VEvec2(:,3) = complex( ones(size(Ixx)) );%!
% Regularization of Values
% Evec2(~isfinite(Evec2)) = 0; % all NaNs and Vnf must be equal to 0!
% Normalization of Evec2 to unit vector (divided by its norm) 
VEvec2norm = (sum((abs(VEvec2).^2),2)).^(1./2);
VEvec2N = VEvec2./repmat(VEvec2norm,[1 3]);
NaN2Check = ~isfinite(VEvec2N(:,1));
VEvec2Nout = abs(VEvec2N) .* sign(real(VEvec2N));

% Eigenvector V of the third eigenvalue
VEvec3(:,1) = complex( (Ixz.^2.*Iyz - Ixy.*Izz.*Ixz + Iyz.^3 - Iyy.*Izz.*Iyz)./(Ixy.*Ixz.^2 - Ixy.*Iyz.^2 - Ixx.*Ixz.*Iyz + Ixz.*Iyy.*Iyz) - (Iyz.*(Ixx./3 + Iyy./3 + Izz./3 - ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3)./(2.*((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + (((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^2 - ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3).^3).^(1./2) + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^(1./3)) + (3.^(1./2).*(((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3)./((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + (((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^2 - ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3).^3).^(1./2) + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^(1./3) - ((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + (((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^2 - ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3).^3).^(1./2) + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^(1./3)).*1i)./2 - ((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + (((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^2 - ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3).^3).^(1./2) + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^(1./3)./2).^2)./(Ixy.*Ixz.^2 - Ixy.*Iyz.^2 - Ixx.*Ixz.*Iyz + Ixz.*Iyy.*Iyz) + ((Ixy.*Ixz + Iyy.*Iyz + Iyz.*Izz).*(Ixx./3 + Iyy./3 + Izz./3 - ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3)./(2.*((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + (((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^2 - ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3).^3).^(1./2) + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^(1./3)) + (3.^(1./2).*(((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3)./((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + (((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^2 - ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3).^3).^(1./2) + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^(1./3) - ((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + (((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^2 - ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3).^3).^(1./2) + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^(1./3)).*1i)./2 - ((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + (((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^2 - ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3).^3).^(1./2) + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^(1./3)./2))./(Ixy.*Ixz.^2 - Ixy.*Iyz.^2 - Ixx.*Ixz.*Iyz + Ixz.*Iyy.*Iyz) );
VEvec3(:,2) = complex( (Ixz.*(Ixx./3 + Iyy./3 + Izz./3 - ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3)./(2.*((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + (((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^2 - ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3).^3).^(1./2) + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^(1./3)) + (3.^(1./2).*(((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3)./((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + (((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^2 - ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3).^3).^(1./2) + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^(1./3) - ((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + (((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^2 - ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3).^3).^(1./2) + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^(1./3)).*1i)./2 - ((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + (((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^2 - ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3).^3).^(1./2) + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^(1./3)./2).^2)./(Ixy.*Ixz.^2 - Ixy.*Iyz.^2 - Ixx.*Ixz.*Iyz + Ixz.*Iyy.*Iyz) - (Ixz.^3 + Ixz.*Iyz.^2 - Ixx.*Izz.*Ixz - Ixy.*Izz.*Iyz)./(Ixy.*Ixz.^2 - Ixy.*Iyz.^2 - Ixx.*Ixz.*Iyz + Ixz.*Iyy.*Iyz) - ((Ixx.*Ixz + Ixy.*Iyz + Ixz.*Izz).*(Ixx./3 + Iyy./3 + Izz./3 - ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3)./(2.*((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + (((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^2 - ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3).^3).^(1./2) + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^(1./3)) + (3.^(1./2).*(((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3)./((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + (((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^2 - ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3).^3).^(1./2) + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^(1./3) - ((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + (((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^2 - ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3).^3).^(1./2) + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^(1./3)).*1i)./2 - ((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + (((Ixx + Iyy + Izz).^3./27 - (Ixz.^2.*Iyy)./2 - (Ixy.^2.*Izz)./2 - (Ixx.*Iyz.^2)./2 + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^2 - ((Ixx + Iyy + Izz).^2./9 + Ixy.^2./3 + Ixz.^2./3 + Iyz.^2./3 - (Ixx.*Iyy)./3 - (Ixx.*Izz)./3 - (Iyy.*Izz)./3).^3).^(1./2) + ((Ixx + Iyy + Izz).*(Ixy.^2 + Ixz.^2 + Iyz.^2 - Ixx.*Iyy - Ixx.*Izz - Iyy.*Izz))./6 + Ixy.*Ixz.*Iyz + (Ixx.*Iyy.*Izz)./2).^(1./3)./2))./(Ixy.*Ixz.^2 - Ixy.*Iyz.^2 - Ixx.*Ixz.*Iyz + Ixz.*Iyy.*Iyz) );
VEvec3(:,3) = complex( ones(size(Ixx)) );%!
% Regularization of Values
% Evec3(~isfinite(Evec3)) = 0; % all NaNs and Vnf must be equal to 0!
% Normalization of Evec3 to unit vector (divided by its norm) 
VEvec3norm = (sum((abs(VEvec3).^2),2)).^(1./2);
VEvec3N = VEvec3./repmat(VEvec3norm,[1 3]);
NaN3Check = ~isfinite(VEvec3N(:,1));
VEvec3Nout = abs(VEvec3N) .* sign(real(VEvec3N));

idx2discard = NaN1Check | NaN2Check | NaN3Check;

if AbsoluteFlag
    VEvalout = abs(VEvalout);
end

if SortByMagnitude
    
    % Sorting Eigenvalues (by norm)
    [~,IDX] = sort(abs(VEvalout),2);
    
    L1l1 = IDX(:,1) == 1;
    L1l2 = IDX(:,2) == 1;
    L1l3 = IDX(:,3) == 1;
    
    L2l1 = IDX(:,1) == 2;
    L2l2 = IDX(:,2) == 2;
    L2l3 = IDX(:,3) == 2;
    
    L3l1 = IDX(:,1) == 3;
    L3l2 = IDX(:,2) == 3;
    L3l3 = IDX(:,3) == 3;
    
    
    % Direction Along the Vessel (minimum intensity variation)
    % EigenValues
    Evl1 = zeros(size(VEvalout,1),1);
    Evl1(L1l1,1) = VEvalout(L1l1,1);
    Evl1(L2l1,1) = VEvalout(L2l1,2);
    Evl1(L3l1,1) = VEvalout(L3l1,3);
    % EigenVectors
    Evc1 = zeros(size(VEvalout,1),3);
    Evc1(L1l1,:) = VEvec1Nout(L1l1,:);
    Evc1(L2l1,:) = VEvec2Nout(L2l1,:);
    Evc1(L3l1,:) = VEvec3Nout(L3l1,:);
    
    % First Orthogonal Base
    % EigenValues
    Evl2 = zeros(size(VEvalout,1),1);
    Evl2(L1l2,1) = VEvalout(L1l2,1);
    Evl2(L2l2,1) = VEvalout(L2l2,2);
    Evl2(L3l2,1) = VEvalout(L3l2,3);
    % EigenVectors
    Evc2 = zeros(size(VEvalout,1),3);
    Evc2(L1l2,:) = VEvec1Nout(L1l2,:);
    Evc2(L2l2,:) = VEvec2Nout(L2l2,:);
    Evc2(L3l2,:) = VEvec3Nout(L3l2,:);
    
    % Second Orthogonal Base
    % EigenValues
    Evl3 = zeros(size(VEvalout,1),1);
    Evl3(L1l3,1) = VEvalout(L1l3,1);
    Evl3(L2l3,1) = VEvalout(L2l3,2);
    Evl3(L3l3,1) = VEvalout(L3l3,3);
    %EigenVectors
    Evc3 = zeros(size(VEvalout,1),3);
    Evc3(L1l3,:) = VEvec1Nout(L1l3,:);
    Evc3(L2l3,:) = VEvec2Nout(L2l3,:);
    Evc3(L3l3,:) = VEvec3Nout(L3l3,:);
    
else
    
    Evl1 = VEvalout(:,1);
    Evl2 = VEvalout(:,2);
    Evl3 = VEvalout(:,3);
    
    Evc1 = VEvec1Nout;
    Evc2 = VEvec2Nout;
    Evc3 = VEvec3Nout;
    
end